<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Tfa7a Store â€” Ø§Ù„ÙƒØ§Ù…Ù„</title>
<link rel="icon" href="https://cdn.discordapp.com/attachments/1256705915487260743/1420677606805737514/logo_store.png">
<style>
:root{--bg:#0b0b0d;--card:#0f1113;--muted:#9aa0a6;--accent:#b91c1c;--glass:rgba(255,255,255,0.03);--radius:12px;font-family:Inter,system-ui,Arial,sans-serif}
*{box-sizing:border-box}
html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#050506);color:#e9ecef}
a{color:inherit}
header{display:flex;align-items:center;justify-content:space-between;padding:12px 18px;background:rgba(255,255,255,0.02);backdrop-filter:blur(4px)}
.brand{display:flex;align-items:center;gap:12px}
.brand img{width:56px;height:56px;border-radius:10px;pointer-events:none}
.brand h1{margin:0;font-size:18px}
.nav{display:flex;gap:8px;align-items:center}
.btn{background:var(--accent);color:#fff;padding:9px 12px;border-radius:10px;border:0;cursor:pointer;font-weight:600}
.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 10px;border-radius:10px;color:var(--muted)}
.container{padding:22px;max-width:1100px;margin:0 auto}
.hero{display:flex;gap:16px;align-items:center;justify-content:space-between;flex-wrap:wrap}
.banner{background:linear-gradient(180deg,rgba(185,28,28,0.08),transparent);padding:18px;border-radius:12px}
.products{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px;margin-top:18px}
.card{background:var(--card);padding:14px;border-radius:12px;border:1px solid rgba(255,255,255,0.02);position:relative;overflow:hidden}
.card img{width:100%;height:150px;object-fit:cover;border-radius:8px;pointer-events:none;user-drag:none}
.card h3{margin:10px 0 6px 0}
.desc{color:var(--muted);font-size:13px;white-space:pre-line}
.price{font-weight:700;color:var(--accent);margin-top:8px}
.footer{padding:20px;text-align:center;color:var(--muted);border-top:1px solid rgba(255,255,255,0.02);margin-top:30px}
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);padding:20px;z-index:60}
.panel{background:var(--card);padding:18px;border-radius:12px;max-width:920px;width:100%}
input,textarea,select{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
.row{display:flex;gap:8px}.col{flex:1}
.small{font-size:13px;color:var(--muted)}
/* responsive */
@media (max-width:720px){header{padding:10px}.products{grid-template-columns:repeat(auto-fill,minmax(220px,1fr))}}
</style>
</head>
<body oncontextmenu="return false;" ondragstart="return false;" onselectstart="return false;">

<header>
  <div class="brand">
    <img src="https://cdn.discordapp.com/attachments/1256705915487260743/1420677606805737514/logo_store.png" alt="logo">
    <div>
      <h1>Tfa7a Store</h1>
      <div class="small">Ù…ØªØ¬Ø±Ùƒ â€” Dark theme</div>
    </div>
  </div>
  <nav class="nav">
    <button class="ghost" onclick="route('#/')">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
    <button class="ghost" onclick="route('#/products')">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</button>
    <button class="ghost" onclick="route('#/reviews')">Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</button>
    <button class="ghost" onclick="route('#/orders')">Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button>
    <button class="btn" id="loginBtn">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</button>
    <a class="btn" href="https://discord.gg/YezDh9ZxB8" target="_blank">Ø¯ÙŠØ³ÙƒÙˆØ±Ø¯</a>
  </nav>
</header>

<main class="container" id="app"></main>

<div class="footer">Â© <span id="year"></span> Tfa7a Store â€” ÙƒÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</div>

<!-- Modals -->
<div class="modal" id="loginModal"><div class="panel"><h3>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h3><label>Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„</label><input id="loginEmail" placeholder="email"><label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label><input id="loginPass" type="password"><div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px"><button class="ghost" id="closeLogin">Ø¥Ù„ØºØ§Ø¡</button><button class="btn" id="doLogin">Ø¯Ø®ÙˆÙ„</button></div></div></div>

<div class="modal" id="adminModal"><div class="panel" id="adminPanel"><h3>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØªØ¬Ø±</h3>
  <div style="display:flex;gap:8px;margin-bottom:12px"><button class="btn" id="manageProductsBtn">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</button><button class="btn" id="manageOrdersBtn">Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button><button class="btn" id="manageReviewsBtn">Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</button><button class="ghost" id="closeAdmin">Ø¥ØºÙ„Ø§Ù‚</button></div>
  <div id="adminContent"></div>
</div></div>

<div class="modal" id="buyModal"><div class="panel"><h3 id="buyTitle">Ø´Ø±Ø§Ø¡</h3>
  <div id="buyDesc" class="desc small"></div>
  <div style="display:flex;gap:8px;margin-top:10px"><div class="col"><label>Ø§Ù„Ø§Ø³Ù…</label><input id="custName"></div><div class="col"><label>Ø§Ù„Ø§ÙŠÙ…ÙŠÙ„</label><input id="custEmail"></div></div>
  <div style="display:flex;gap:8px;margin-top:8px"><div class="col"><label>Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</label><input id="custPhone" placeholder="+9665..."></div><div class="col"><label>Ù…Ù„Ø§Ø­Ø¸Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label><input id="custNote"></div></div>
  <div style="margin-top:12px"><label>Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</label><select id="payMethod"><option value="paypal">PayPal</option><option value="stc">STCPay (ÙŠØ¯ÙˆÙŠ)</option><option value="ur">UrPay (ÙŠØ¯ÙˆÙŠ)</option></select></div>
  <div style="margin-top:12px;display:flex;gap:8px;justify-content:flex-end"><button class="ghost" id="cancelBuy">Ø¥Ù„ØºØ§Ø¡</button><button class="btn" id="confirmBuy">ØªØ£ÙƒÙŠØ¯ & Ø¯ÙØ¹</button></div>
</div></div>

<div class="modal" id="qrModal"><div class="panel"><h3>ØªØ­ÙˆÙŠÙ„ ÙŠØ¯ÙˆÙŠ</h3><div id="qrWrap"></div><div class="small" id="qrInfo" style="margin-top:8px"></div><div style="margin-top:12px;text-align:right"><button class="btn" id="closeQr">ØªÙ…</button></div></div></div>

<!-- QR lib -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>

<script>
// -------------- CONFIG --------------
const STORE_EMAIL = 'tfa7astore@store.com';
const STORE_PASS = 'tfa7astore';
const PAYPAL_EMAIL = 'xxz05549@gmail.com'; // where money goes
const EXCHANGE_RATE = 3.75; // 1 USD = 3.75 SAR (fixed)
const STC_PHONE = '+966508722561';
const UR_PHONE = '+966508722561';

// -------------- DATA (initial) --------------
let products = [
  {id:1,slug:'execution',title:'ãƒğ—²ğ˜…ğ—²ğ—°ğ˜‚ğ˜ğ—¶ğ—¼ğ—»',price:15,desc:`ÙŠØªÙ… ØªÙˆÙÙŠØ± Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ø¹ Ø®Ø¯Ù…Ø© ØªØ±ÙƒÙŠØ¨ Ù…Ø¬Ø§Ù†ÙŠÙ‡
Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ø§ÙŠØ¬ÙŠ Ù…Ø¹Ù‡ Ù„Ø§ÙƒØ±Ø³ÙŠ ÙˆÙ„Ø§ Ù…Ø§Ø¨ ÙÙ‚Ø· Ø³ÙƒØ±Ø¨Øª ÙˆØªØ­ØªØ§Ø¬ ØªØ±Ø¨Ø·Ù‡ ÙˆØªØ±ÙƒÙŠØ¨Ù‡ Ù…Ø¹Ù‚Ø¯
Ù…Ø¹ Ù†Ø³Ø®ØªÙ†Ø§ Ù…Ø¹Ø¯Ù„Ù‡ ÙˆÙ…Ø¶Ø§Ù Ø¹Ù„ÙŠÙ‡ Ù…Ø§Ø¨ Ø§Ø®Ø± ÙˆØ®Ø§Øµ ÙŠØ¯Ø¹Ù… Ø§Ù„Ø³ÙƒØ±Ø¨Øª ÙˆÙ…Ø¹ ÙƒØ±Ø³ÙŠ Ø®Ø§Øµ
ÙŠØ¯Ø¹Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠÙ‡ ÙˆØ§Ù„Ø§Ù†Ù‚Ù„ÙŠØ²ÙŠÙ‡ Ù…ÙˆÙØ±ÙŠÙ† Ø§Ù„Ù†Ø³Ø®ØªÙŠ`,video:'https://www.youtube.com/watch?v=2QiT5jyAaJE'},
  {id:2,slug:'torture',title:'ãƒğ—§ğ—¼ğ—¿ğ˜ğ˜‚ğ—¿ğ—²',price:15,desc:`Ø§ÙŠØªÙ… Ø¨Ø´Ù†Ø·Ù‡ ÙŠÙ†Ø¶Ø§Ù ÙˆÙŠÙ† Ù…Ø§ØªØ¨ØºÙ‰
Ø´ÙƒÙ„ ÙˆÙˆØ§Ø¬Ù‡ Ù†Ø·ÙˆØ±Ù‡Ø§ Ù„Ùƒ Ù†ÙØ³ Ø«ÙŠÙ… ğŸŸ  Ø§Ùˆ ØªØ¨ØºØ§Ù‡ Ø¨Ø´ÙƒÙ„ Ø¨Ø±Ø§Ø³Ùƒ ØªØªÙ…ÙŠØ² ÙÙŠÙ‡
Ø§Ù„Ø§Ø³ÙƒØ±Ø¨Øª Ù‚Ø§Ø¨Ù„ Ù„ØªØ¹Ø¯ÙŠÙ„ ÙˆØ§Ù„Ø§Ø¶Ø§ÙÙ‡ Ø¨Ø§Ø´Øª Ø§Ù„Ø§Ù†ÙˆØ§Ø¹ ÙˆÙ…Ù† Ù‚Ø³Ù…`,video:'https://www.youtube.com/watch?v=jNN1dMnDe28&start=21'},
  {id:3,slug:'medkit',title:'ğ—ºğ—²ğ—±ğ—¸ğ—¶ğ˜',price:15,desc:`Ø³ÙƒØ±Ø¨Øª Ø­ØµØ±ÙŠ Ù…Ø¹ Ù…Ù†ÙŠ Ù‚ÙŠÙ… Ø­ØµØ±ÙŠ
ÙÙŠ Ø­Ø§Ù„ Ø§Ø³Ù‚Ø· ÙŠÙ‚Ø¹Ø¯ ØªØ­Øª Ø§Ù„ÙˆØ¹ÙŠ Ù„ÙŠÙ† Ø¨Ø¹Ø¯Ù‡Ø§ ÙŠØªÙÙ†Ø´
ÙˆÙØ§Ù„Ø§Ø«Ù†Ø§Ø¡ Ù‡Ø§Ø°ÙŠ ÙŠØªØ§Ø­ Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ø§Ø®Ø±ÙŠÙ† Ø§Ù†Ø¹Ø§Ø´Ù‡ Ø¹Ø¨Ø± Ø§Ù„Ù…Ø¯ÙƒØª Ø§Ùˆ Ø§Ù„Ø¨Ø§Ù†Ø¬Ø¯
Ø¹Ø¨Ø± Ø§Ù„ÙƒÙˆÙ†ÙÙ‚ ØªØ­Ø¯Ø¯ Ø§Ù„Ø§ÙŠØªÙ…`},
  {id:4,slug:'itrack',title:'ãƒğ˜ğ—¿ğ—®ğ—°ğ—¸',price:15,desc:`Ø³ÙƒØ±Ø¨Øª Ø§Ù„ÙƒÙ„Ø¨Ø´Ø© Ø§Ù„Ø°ÙƒÙŠØ© â€“ Tfa7a Scripts
Ø§Ù„Ø³ÙƒØ±Ø¨Øª ÙŠÙ‚Ø¯Ù… Ù„Ùƒ Ø£ÙŠØªÙ… ÙƒÙ„Ø¨Ø´Ø© Ù„Ù„Ø±Ø¬Ù„ ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§ Ø¹Ù„Ù‰ Ø£ÙŠ Ù„Ø§Ø¹Ø¨ØŒ ÙˆØ¨Ø¹Ø¯Ù‡Ø§ ØªØªØ­ÙƒÙ… ÙÙŠÙ‡ Ù…Ù† Ø®Ù„Ø§Ù„ Ø¬Ù‡Ø§Ø² Ø®Ø§Øµ.
Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª:
ØªØ±ÙƒÙŠØ¨ Ø§Ù„ÙƒÙ„Ø¨Ø´Ø© Ø¹Ù„Ù‰ Ø£ÙŠ Ù„Ø§Ø¹Ø¨ Ø¨Ø³Ù‡ÙˆÙ„Ø©.
Ø¥Ù…ÙƒØ§Ù†ÙŠØ© ØµØ¹Ù‚ Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø¹Ù† Ø¨ÙØ¹Ø¯ ÙÙŠ Ø£ÙŠ ÙˆÙ‚Øª.
Ù…ØªØ§Ø¨Ø¹Ø© ÙˆØªØ¹Ù‚Ø¨ Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¬Ù‡Ø§Ø².
ÙÙƒ Ø§Ù„ÙƒÙ„Ø¨Ø´Ø© Ù…ØªÙ‰ Ù…Ø§ ØªØ±ÙŠØ¯ Ø¨Ø¶ØºØ·Ø© Ø²Ø±.`},
  {id:5,slug:'syringe',title:'ãƒğ˜€ğ˜†ğ—¿ğ—¶ğ—»ğ—´ğ—²',price:9,desc:`He must take off his shirt
Dose re-testing lab
The map is comprehensive
Dizziness and poisoning for 5 minutes
Video coming soon
Pre-order`},
  // Weed Lap (new) 
  {id:6,slug:'weedlap',title:'Weed Lap',price:10,desc:`Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬ Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙˆØªÙŠÙˆØ¨. ØªØ±ÙƒÙŠØ¨ Ø¨Ø³ÙŠØ·ØŒ Ù†Ø³Ø®Ø© Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø´Ø±Ø§Ø¡.`,video:'https://youtu.be/-YZdDqFHVwE?si=6UZ1hB7GkKV1RRJT'}
];

let reviews = JSON.parse(localStorage.getItem('tfa_reviews')||'[]');
let orders = JSON.parse(localStorage.getItem('tfa_orders')||'[]');

// -------------- ROUTER --------------
const app = document.getElementById('app');
function route(hash){location.hash = hash; render();}
function render(){
  const h = location.hash || '#/';
  if(h.startsWith('#/reviews')) return renderReviews();
  if(h.startsWith('#/orders')) return renderOrders();
  return renderProducts();
}

// -------------- VIEWS --------------
function renderProducts(){
  app.innerHTML = `
    <section class="hero">
      <div class="banner">
        <h2>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Tfa7a Store</h2>
        <p class="small">Ø§Ø´ØªØ±Ù Ø§Ù„Ø¢Ù† Ù…Ø¨Ø§Ø´Ø±Ø© â€” PayPal Ø£Ùˆ ØªØ­ÙˆÙŠÙ„ ÙŠØ¯ÙˆÙŠ (Ø§Ù„Ù…Ø¨Ù„Øº Ø³ÙŠØ¸Ù‡Ø± Ø¨Ø§Ù„Ø±ÙŠØ§Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ø¯ÙØ¹)</p>
      </div>
    </section>
    <section id="productsList">
      <h2 style="margin-top:18px">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h2>
      <div class="products" id="productsGrid"></div>
    </section>
  `;
  const grid = document.getElementById('productsGrid');
  grid.innerHTML = '';
  products.forEach(p=>{
    const div = document.createElement('div'); div.className='card';
    const thumb = p.video ? `https://img.youtube.com/vi/${extractYouTubeID(p.video)}/maxresdefault.jpg` : '';
    div.innerHTML = `
      ${thumb?`<img src="${thumb}" alt="${p.title}">`:''}
      <h3>${p.title}</h3>
      <div class="desc">${p.desc}</div>
      <div class="price">$${p.price}</div>
      <div style="margin-top:10px;display:flex;gap:8px">
        <button class="btn" onclick="openBuy(${p.id})">Ø§Ø´ØªØ±Ù Ø§Ù„Ø¢Ù†</button>
        ${p.video?`<a class="ghost" href="${p.video}" target="_blank">Ø´Ø§Ù‡Ø¯</a>`:''}
        <button class="ghost" onclick="openDetail(${p.id})">ØªÙØ§ØµÙŠÙ„</button>
      </div>
    `;
    grid.appendChild(div);
  });
}

function renderReviews(){
  app.innerHTML = `<h2>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</h2><div id="reviewsList"></div>
    <h3 style="margin-top:18px">Ø£Ø¶Ù ØªÙ‚ÙŠÙŠÙ…</h3>
    <label>Ø§Ù„Ø§Ø³Ù…</label><input id="rName" placeholder="Ø§Ø³Ù…Ùƒ">
    <label>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</label><select id="rRate"><option>5</option><option>4</option><option>3</option><option>2</option><option>1</option></select>
    <label>Ø§Ù„ØªØ¹Ù„ÙŠÙ‚</label><textarea id="rText"></textarea>
    <div style="margin-top:10px;text-align:right"><button class="btn" id="addReviewBtn">Ø¥Ø±Ø³Ø§Ù„</button></div>`;
  document.getElementById('addReviewBtn').onclick = addReview;
  renderReviewsList();
}
function renderReviewsList(){
  const box = document.getElementById('reviewsList'); box.innerHTML = '';
  reviews.slice().reverse().forEach(r=>{
    const d = document.createElement('div'); d.className='card';
    d.innerHTML = `<b>${r.name}</b> â€” <span class="small">${r.date}</span><div class="small">ØªÙ‚ÙŠÙŠÙ…: ${'â˜…'.repeat(r.rate)}</div><div class="desc">${r.text}</div>`;
    box.appendChild(d);
  });
}

function renderOrders(){
  app.innerHTML = `<h2>Ø§Ù„Ø·Ù„Ø¨Ø§Øª (Ù…Ø­Ù„ÙŠÙ‹Ø§)</h2><div id="ordersList"></div>
    <div style="margin-top:12px"><button class="btn" id="exportOrdersBtn">ØªØµØ¯ÙŠØ± Ø§Ù„Ø·Ù„Ø¨Ø§Øª (JSON)</button> <button class="btn" id="exportReviewsBtn">ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª (JSON)</button></div>`;
  const box = document.getElementById('ordersList'); box.innerHTML = '';
  orders.slice().reverse().forEach(o=>{
    const d = document.createElement('div'); d.className='card';
    d.innerHTML = `<b>#${o.id}</b> â€” ${o.product} â€” <div class="small">Ø§Ù„Ù…Ø¨Ù„Øº: $${o.amount} (${convertToSAR(o.amount)} SAR)</div>
      <div class="small">Ø§Ù„Ø§Ø³Ù…: ${o.name} â€” Ø§Ù„Ø§ÙŠÙ…ÙŠÙ„: ${o.email} â€” Ø§Ù„Ù‡Ø§ØªÙ: ${o.phone}</div>
      <div class="desc">Ù…Ù„Ø§Ø­Ø¸Ø©: ${o.note||'-'}</div><div class="small">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹: ${o.method}</div>`;
    box.appendChild(d);
  });
  document.getElementById('exportOrdersBtn').onclick = exportOrders;
  document.getElementById('exportReviewsBtn').onclick = exportReviews;
}

// -------------- PRODUCT DETAIL --------------
function openDetail(id){
  const p = products.find(x=>x.id==id); if(!p) return;
  app.innerHTML = `<button class="ghost" onclick="route('#/products')">Ø¹ÙˆØ¯Ø©</button><h2>${p.title}</h2><div class="desc">${p.desc}</div>
    <div style="margin-top:12px"><div class="price">$${p.price}</div><button class="btn" onclick="openBuy(${p.id})">Ø§Ø´ØªØ±Ù Ø§Ù„Ø¢Ù†</button> ${p.video?`<a class="ghost" href="${p.video}" target="_blank">Ø´Ø§Ù‡Ø¯</a>`:''}</div>`;
}

// -------------- BUY FLOW --------------
const buyModal = document.getElementById('buyModal');
const qrModal = document.getElementById('qrModal');

function openBuy(id){
  const p = products.find(x=>x.id==id); if(!p) return;
  document.getElementById('buyTitle').innerText = p.title;
  document.getElementById('buyDesc').innerText = p.desc;
  document.getElementById('confirmBuy').dataset.pid = id;
  document.getElementById('confirmBuy').dataset.price = p.price;
  buyModal.style.display = 'flex';
}
document.getElementById('cancelBuy').onclick = ()=> buyModal.style.display='none';
document.getElementById('closeQr').onclick = ()=> qrModal.style.display='none';

document.getElementById('confirmBuy').onclick = function(){
  const id = this.dataset.pid; const price = parseFloat(this.dataset.price);
  const name = document.getElementById('custName').value || 'Ø²Ø§Ø¦Ø±';
  const email = document.getElementById('custEmail').value || '';
  const phone = document.getElementById('custPhone').value || '';
  const note = document.getElementById('custNote').value || '';
  const method = document.getElementById('payMethod').value;
  const order = {id: Date.now(), product: products.find(p=>p.id==id).title, amount: price, name, email, phone, note, method, date: new Date().toLocaleString()};
  orders.push(order); localStorage.setItem('tfa_orders', JSON.stringify(orders));
  buyModal.style.display = 'none';
  if(method === 'paypal'){
    // convert amount to SAR and open PayPal with SAR currency
    const sar = convertToSAR(price);
    const url = `https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&business=${encodeURIComponent(PAYPAL_EMAIL)}&amount=${encodeURIComponent(sar)}&currency_code=SAR&item_name=${encodeURIComponent(order.product)}`;
    window.open(url, '_blank');
    alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨ Ù…Ø­Ù„ÙŠØ§Ù‹. Ø³ÙŠØªÙ… ÙØªØ­ PayPal Ù„Ù„Ø¯ÙØ¹ Ø¨Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø­ÙˆÙ„ (SAR).');
  } else {
    // Show QR for STC/UrPay
    qrModal.style.display = 'flex';
    const wrap = document.getElementById('qrWrap'); wrap.innerHTML = '';
    const canvas = document.createElement('canvas'); wrap.appendChild(canvas);
    const phone = method === 'stc' ? STC_PHONE : UR_PHONE;
    const sar = convertToSAR(price);
    const qrText = `${method==='stc'?'STCPay':'UrPay'}:${phone};amount:${sar} SAR`;
    new QRious({element:canvas, value:qrText, size:220});
    document.getElementById('qrInfo').innerText = `Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ­ÙˆÙŠÙ„ ${sar} Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ Ø¥Ù„Ù‰ ${phone} Ø«Ù… Ø£Ø±Ø³Ù„ Ø¥ÙŠØµØ§Ù„ Ø§Ù„Ø¯ÙØ¹ ÙÙŠ Ø¯ÙŠØ³ÙƒÙˆØ±Ø¯ Ø£Ùˆ ÙˆØ§ØªØ³Ø§Ø¨.`;
  }
};

// -------------- Admin (login & manage) --------------
const loginModal = document.getElementById('loginModal');
const adminModal = document.getElementById('adminModal');

document.getElementById('loginBtn').onclick = ()=> loginModal.style.display='flex';
document.getElementById('closeLogin').onclick = ()=> loginModal.style.display='none';
document.getElementById('doLogin').onclick = ()=>{
  const e = document.getElementById('loginEmail').value;
  const p = document.getElementById('loginPass').value;
  if(e===STORE_EMAIL && p===STORE_PASS){ loginModal.style.display='none'; openAdmin(); } else alert('Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
};

function openAdmin(){
  adminModal.style.display='flex';
  renderAdminProducts();
}
document.getElementById('closeAdmin').onclick = ()=> adminModal.style.display='none';

const adminContent = document.getElementById('adminContent');
document.getElementById('manageProductsBtn').onclick = renderAdminProducts;
document.getElementById('manageOrdersBtn').onclick = renderAdminOrders;
document.getElementById('manageReviewsBtn').onclick = renderAdminReviews;

function renderAdminProducts(){
  adminContent.innerHTML = `<h4>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h4>
    <div style="display:flex;gap:8px;margin-bottom:8px">
      <div class="col"><label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</label><input id="aTitle"></div>
      <div class="col"><label>Ø§Ù„Ø³Ø¹Ø± (USD)</label><input id="aPrice" type="number"></div>
    </div>
    <label>Ø§Ù„ÙˆØµÙ</label><textarea id="aDesc"></textarea>
    <label>Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ/ØµÙˆØ±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label><input id="aMedia">
    <div style="text-align:right;margin-top:10px"><button class="btn" id="addProdBtn">Ø¥Ø¶Ø§ÙØ©</button></div>
    <hr><div id="prodList"></div>`;
  document.getElementById('addProdBtn').onclick = addProduct;
  renderAdminProdList();
}
function renderAdminProdList(){
  const box = document.getElementById('prodList'); box.innerHTML='';
  products.forEach((p,i)=>{
    const d = document.createElement('div'); d.className='card';
    d.innerHTML = `<b>${p.title}</b> â€” $${p.price}<div class="small" style="margin-top:8px">${(p.desc||'').substring(0,120)}...</div>
      <div style="margin-top:8px;text-align:right"><button class="ghost" onclick="editProd(${i})">ØªØ¹Ø¯ÙŠÙ„</button><button class="ghost" onclick="delProd(${i})">Ø­Ø°Ù</button></div>`;
    box.appendChild(d);
  });
}
function addProduct(){
  const t = document.getElementById('aTitle').value;
  const pr = parseFloat(document.getElementById('aPrice').value);
  const d = document.getElementById('aDesc').value;
  const m = document.getElementById('aMedia').value;
  if(!t || isNaN(pr)){ alert('Ø¹Ø¨ÙŠ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø³Ø¹Ø±'); return; }
  products.push({id:Date.now(), title:t, price:pr, desc:d, video:m});
  renderAdminProdList(); renderProducts();
  alert('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬');
}
function editProd(i){
  const p = products[i];
  const t = prompt('Ø§Ù„Ø§Ø³Ù…', p.title); if(t!==null) products[i].title = t;
  const pr = prompt('Ø§Ù„Ø³Ø¹Ø±', p.price); if(pr!==null) products[i].price = parseFloat(pr);
  const d = prompt('Ø§Ù„ÙˆØµÙ', p.desc); if(d!==null) products[i].desc = d;
  renderAdminProdList(); renderProducts();
}
function delProd(i){ if(confirm('ØªØ£ÙƒÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ØŸ')){ products.splice(i,1); renderAdminProdList(); renderProducts(); } }

function renderAdminOrders(){
  adminContent.innerHTML = '<h4>Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h4><div id="adminOrders"></div><div style="margin-top:10px;text-align:right"><button class="btn" id="exportOrdersAdmin">ØªØµØ¯ÙŠØ± Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button></div>';
  const box = document.getElementById('adminOrders'); box.innerHTML = '';
  orders.slice().reverse().forEach(o=>{
    const d = document.createElement('div'); d.className='card';
    d.innerHTML = `<b>#${o.id}</b> â€” ${o.product} â€” $${o.amount} (${convertToSAR(o.amount)} SAR)
      <div class="small">Ø§Ù„Ø§Ø³Ù…: ${o.name} â€” ${o.phone} â€” ${o.email}</div>
      <div class="desc">Ù…Ù„Ø§Ø­Ø¸Ø©: ${o.note||'-'}</div>
      <div style="margin-top:8px;text-align:right"><button class="ghost" onclick="markPaid(${o.id})">ØªÙ… Ø§Ù„Ø¯ÙØ¹</button></div>`;
    box.appendChild(d);
  });
  document.getElementById('exportOrdersAdmin').onclick = exportOrders;
}
function markPaid(id){
  const idx = orders.findIndex(o=>o.id==id); if(idx>-1){ orders[idx].status='paid'; localStorage.setItem('tfa_orders', JSON.stringify(orders)); alert('ÙˆÙØ¶ÙØ¹: Ù…Ø¯ÙÙˆØ¹'); renderAdminOrders(); }
}
function renderAdminReviews(){
  adminContent.innerHTML = '<h4>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</h4><div id="admRev"></div><div style="margin-top:10px;text-align:right"><button class="btn" id="exportReviewsAdmin">ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</button></div>';
  const box = document.getElementById('admRev'); box.innerHTML='';
  reviews.slice().reverse().forEach(r=>{
    const d = document.createElement('div'); d.className='card';
    d.innerHTML = `<b>${r.name}</b> â€” ${r.date}<div class="small">ØªÙ‚ÙŠÙŠÙ…: ${'â˜…'.repeat(r.rate)}</div><div class="desc">${r.text}</div>`;
    box.appendChild(d);
  });
  document.getElementById('exportReviewsAdmin').onclick = exportReviews;
}

// -------------- HELPERS --------------
function convertToSAR(usd){ const n = parseFloat(usd); if(isNaN(n)) return '0.00'; return (n * EXCHANGE_RATE).toFixed(2); }
function extractYouTubeID(url){
  try{
    const u = new URL(url);
    if(u.hostname.includes('youtu.be')) return u.pathname.slice(1);
    if(u.searchParams.get('v')) return u.searchParams.get('v');
    // fallback start param parsing
    const sp = url.split('/').pop(); return sp;
  }catch(e){ return '';}
}

// export functions
function downloadFile(filename,content){
  const blob = new Blob([content], {type:'application/json'}); const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = filename; document.body.appendChild(a); a.click(); a.remove();
  URL.revokeObjectURL(url);
}
function exportOrders(){ downloadFile('tfa_orders.json', JSON.stringify(orders,null,2)); }
function exportReviews(){ downloadFile('tfa_reviews.json', JSON.stringify(reviews,null,2)); }

// add review
function addReview(){
  const name = document.getElementById('rName').value || 'Ø²Ø§Ø¦Ø±';
  const rate = parseInt(document.getElementById('rRate').value || '5');
  const text = document.getElementById('rText').value || '';
  reviews.push({id:Date.now(), name, rate, text, date: new Date().toLocaleString()});
  localStorage.setItem('tfa_reviews', JSON.stringify(reviews));
  alert('ØªÙ… Ø¥Ø¶Ø§ÙØ© ØªÙ‚ÙŠÙŠÙ…'); renderReviews();
}

// mark initial route & UI hookups
document.getElementById('year').innerText = new Date().getFullYear();
if(!location.hash) location.hash = '#/';
render();

// close admin/login buttons
// (already bound above)
</script>

</body>
</html>
